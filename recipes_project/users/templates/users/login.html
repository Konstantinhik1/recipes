<!DOCTYPE html>

{% load static %}

<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Авторизация</title>
    <link rel="stylesheet" href="{% static 'users/css/styles.css' %}"/>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>
    <div class="menu">
        <div class="logo">
            <img src="{% static 'users/img/logo1.png' %}" alt="Логотип">
        </div>
        <div class="menu_list">
            <div class="list">
                <a href="{% url 'index' %}">Главная</a>
            </div>
            <div class="list">
                <a href="{% url 'recipe_catalog' %}">Рецепты</a>
            </div>
        </div>
        <div class="menu_enter">
            <div class="enter_img1">
                <img class="enter_img" src="{% static 'users/img/user.svg' %}" alt="User">
            </div>
            <div class="list">
                <a href="{% url 'login' %}">Войти</a>
            </div>
        </div>
    </div>

    <div class="form-container">
        <h1>Войти</h1>
        <form method="post">
            {% csrf_token %}
            <div class="form-group">
                <img class="icon" src="{% static 'users/img/login.png' %}" alt="User">
                <input type="text" name="username" placeholder="Логин" value="{{ form.username.value|default:'' }}" required>
                {% if form.username.errors %}
                    <div class="error-message">
                        * {% for error in form.username.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            <div class="form-group">
                <img class="icon" src="{% static 'users/img/key.png' %}" alt="User">
                <input type="password" id="password-field" name="password" placeholder="Пароль" value="{{ form.password.value|default:'' }}" required>
                {% if form.password.errors %}
                    <div class="error-message">
                        * {% for error in form.password.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
                <img id="toggle-password-icon" class="toggle-password" onclick="togglePassword()" src="{% static 'users/img/eye.png' %}" alt="Show/Hide Password">
            </div>

            <!-- Вывод сообщений об ошибках и успехах -->
            {% if messages %}
                <div class="messages">
                    {% for message in messages %}
                        <div class="message {{ message.tags }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

            <button type="submit" class="form-button">Войти</button>
        </form>

        <p class="info-text">Уже есть аккаунт?</p>
        <a href="{% url 'register' %}" class="info-link">Зарегистрироваться</a>
    </div>

    <!-- Всплывающее окно для уже авторизованного пользователя -->
    {% if user_logged_in %}
        <div id="popup" class="popup">
            <div class="popup-content">
                <p>Вы уже вошли в систему!</p>
                <a href="{% url 'logout' %}" class="popup-button">Выйти</a>
                <button class="popup-button" onclick="closePopup()">Закрыть</button>
            </div>
        </div>
    {% endif %}

    <script>
        function togglePassword() {
            const passwordField = document.getElementById('password-field');
            const toggleIcon = document.getElementById('toggle-password-icon');
            const isPassword = passwordField.getAttribute('type') === 'password';
            passwordField.setAttribute('type', isPassword ? 'text' : 'password');
            toggleIcon.setAttribute('src', isPassword
                ? "{% static 'users/img/eye_close.png' %}"
                : "{% static 'users/img/eye.png' %}");
        }

        //Функция для закрытия попапа
        function closePopup() {
            document.getElementById('popup').style.display = 'none';
        }

        // Показываем всплывающее окно, если оно есть
        {% if user_logged_in %}
            document.getElementById('popup').style.display = 'flex';
        {% endif %}
    </script>

</body>
</html>